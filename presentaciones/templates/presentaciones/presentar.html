{% extends 'presentaciones/base.html' %}
{% load static %}

{% block extra_head %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.8.162/pdf.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
    /* Estilos cr√≠ticos inline para asegurar que se apliquen */
    body {
        background: transparent !important;
    }
    
    body .base-container {
        background: transparent !important;
    }
    
    body .main-content {
        padding: 0 !important;
        margin: 0 !important;
        background: transparent !important;
        min-height: auto !important;
    }
    
    body .main-content .presentar-container {
        min-height: calc(100vh - 80px);
        background: linear-gradient(to bottom, 
            #ffffff 0%, 
            #ffffff 50%, 
            #f5f0ff 60%,
            #ead9ff 75%,
            #A855F7 100%
        ) !important;
        padding: 2rem 1rem 3rem !important;
        width: 100% !important;
    }
    
    .presentar-content {
        max-width: 1400px;
        margin: 0 auto !important;
    }
    
    .presentar-card {
        background: white !important;
        border-radius: 16px;
        padding: 2.5rem;
        box-shadow: 0 4px 20px rgba(168, 85, 247, 0.15);
    }
    
    .presentar-card .presentar-title {
        font-size: 2rem !important;
        font-weight: 700 !important;
        color: #1f2937 !important;
        text-align: center;
        margin: 0 0 1.5rem 0 !important;
    }
</style>
<link rel="stylesheet" href="{% static 'css/presentar.css' %}">
{% endblock %}

{% block title %}Visor de Presentaci√≥n - {{ presentacion.titulo }}{% endblock %}

{% block content %}
<div class="presentar-container">
    <div class="presentar-content">
        <div class="presentar-card">
            <h1 class="presentar-title">
                {{ presentacion.titulo }}
            </h1>

            {% if detector_iniciado %}
            <div class="alert alert-success">
                <div class="alert-content">
                    <svg class="alert-icon" fill="currentColor" viewBox="0 0 20 20" width="20" height="20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <p class="alert-text">{{ mensaje_detector }}</p>
                </div>
            </div>
            {% else %}
            <div class="alert alert-warning">
                <div class="alert-content">
                    <svg class="alert-icon" fill="currentColor" viewBox="0 0 20 20" width="20" height="20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                    </svg>
                    <p class="alert-text">{{ mensaje_detector }}</p>
                </div>
            </div>
            {% endif %}

            <div class="controls-section">
                <div class="info-section">
                    <span id="page-info" class="page-info">Cargando PDF...</span>
                    <span id="zoom-info" class="zoom-info">Zoom: 100%</span>
                </div>

                <span id="last-command" class="last-command">√öltimo comando: ninguno</span>

                <div class="buttons-section">
                    <div class="zoom-buttons">
                        <button id="zoom-out" class="btn-zoom">-</button>
                        <button id="reset-zoom" class="btn-zoom btn-zoom-reset">Reset</button>
                        <button id="zoom-in" class="btn-zoom">+</button>
                    </div>
                    
                    <div class="drawing-controls" id="drawing-controls">
                        <button id="toggle-drawing" class="btn-drawing">Dibujo</button>
                        <button id="clear-drawings" class="btn-clear">Limpiar</button>
                    </div>
                </div>
            </div>

            <div class="pdf-viewer-wrapper">
                <button id="prev-page" class="btn-nav-side btn-nav-prev" disabled>
                    <i class="fas fa-chevron-left"></i>
                </button>

                <div id="pdf-container" class="pdf-container">
                    <div class="status-indicator" id="mode-indicator">NAVEGACI√ìN</div>
                    <div class="drawing-mode-indicator" id="drawing-mode-indicator">MODO DIBUJO: OFF</div>
                    <div class="zoom-indicator" id="zoom-indicator">100%</div>

                    <div id="canvas-container">
                        <canvas id="pdf-canvas"></canvas>
                        <canvas id="drawing-canvas"></canvas>
                        
                        <div id="pointer-overlay">
                            <div id="pointer-dot" class="pointer-dot" style="display: none;">
                                <div class="pointer-outer">
                                    <div class="pointer-inner"></div>
                                    <div class="pointer-crosshair-h"></div>
                                    <div class="pointer-crosshair-v"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button id="next-page" class="btn-nav-side btn-nav-next" disabled>
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <div class="gestures-guide">
                <h3 class="gestures-title">Controles de Gestos:</h3>
                <div class="gestures-grid">
                    <div class="gesture-item">
                        <span class="gesture-badge gesture-badge-yellow">‚úä</span>
                        <span class="gesture-text"><strong>Pu√±o cerrado:</strong> Activa puntero</span>
                    </div>
                    <div class="gesture-item">
                        <span class="gesture-badge gesture-badge-red">üñêÔ∏è</span>
                        <span class="gesture-text"><strong>Ambas manos abiertas:</strong> Zoom din√°mico</span>
                    </div>
                    <div class="gesture-item">
                        <span class="gesture-badge gesture-badge-green">üëâ</span>
                        <span class="gesture-text"><strong>Pistola derecha:</strong> P√°gina siguiente</span>
                    </div>
                    <div class="gesture-item">
                        <span class="gesture-badge gesture-badge-green">üëà</span>
                        <span class="gesture-text"><strong>Pistola izquierda:</strong> P√°gina anterior</span>
                    </div>
                    <div class="gesture-item">
                        <span class="gesture-badge gesture-badge-purple">ü§ü</span>
                        <span class="gesture-text"><strong>Gesto L:</strong> Toggle modo dibujo</span>
                    </div>
                    <div class="gesture-item">
                        <span class="gesture-badge gesture-badge-blue">‚òùÔ∏è</span>
                        <span class="gesture-text"><strong>Pu√±o + √≠ndice:</strong> Dibujar</span>
                    </div>
                    <div class="gesture-item">
                        <span class="gesture-badge gesture-badge-orange">ü§ô</span>
                        <span class="gesture-text"><strong>Pu√±o + me√±ique:</strong> Borrar</span>
                    </div>
                </div>
            </div>

            <div id="error-message" class="error-message" style="display: none;">
                <p>Error: No se pudo cargar el documento PDF.</p>
            </div>
        </div>
    </div>
</div>

<script>
    const PDF_URL = "{{ url_pdf }}";
    const COMANDO_GESTO_URL = "{% url 'presentaciones:comando_gesto' %}";
    
    {% if debug %}
    console.log('=== DEBUG INFO ===');
    console.log('PDF URL:', PDF_URL);
    console.log('Comando Gesto URL:', COMANDO_GESTO_URL);
    console.log('Presentaci√≥n ID:', {{ presentacion.id }});
    console.log('==================');
    {% endif %}
</script>
<script src="{% static 'js/presentar.js' %}"></script>
{% endblock %}